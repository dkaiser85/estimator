<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Culture MRIÂ® Performance Estimator</title>
    <!-- Import Inter Font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Viewport Meta Tag -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- jsPDF and html2canvas Libraries for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Apply Inter Font */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            padding: 20px;
            margin: 0;
        }

        /* Container Styling */
        .calculator-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            padding: 25px;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Header Styling */
        .calculator-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .calculator-header h2 {
            font-size: 28px;
            font-weight: 700; /* Inter Bold */
            color: #333333;
            margin-bottom: 5px;
        }

        .calculator-header p {
            font-size: 16px;
            font-weight: 300; /* Inter Light */
            color: #6B7D8D;
            margin: 0;
        }

        /* Input Section */
        .input-section {
            margin-bottom: 25px;
        }

        .input-group {
            margin-bottom: 25px;
            padding: 0 20px; /* Keep padding for consistent styling */
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 300; /* Inter Light */
            color: #6B7D8D;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            font-weight: 400; /* Inter Regular */
            border: 1px solid #d3d3d3;
            border-radius: 6px;
            outline: none;
        }

        /* Generate Report Button */
        #generateReportButton {
            width: 75%;
            padding: 12px;
            background-color: #6666c6;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        #generateReportButton:hover {
            background-color: #496691;
        }

        /* Results Section */
        .results-section {
            margin-top: 25px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .result-item {
            width: 48%;
            margin-bottom: 25px;
            text-align: center;
        }

        .result-item h3 {
            font-size: 18px;
            font-weight: 300; /* Inter Light */
            color: #6B7D8D;
            margin-bottom: 10px;
        }

        /* Gauge Styling */
        .gauge {
            width: 195px;
            height: 195px;
            position: relative;
            margin: 0 auto 10px; /* Reduced margin-bottom if necessary */
        }

        .gauge__background {
            stroke: #EFEFEF;
            stroke-width: 10;
            fill: none;
        }

        .gauge__fill {
            stroke-linecap: round;
            stroke-width: 10;
            fill: none;
            transition: stroke-dashoffset 0.5s ease-out, stroke 0.5s ease;
        }

        /* Financial Metrics */
        .financial-metrics {
            width: 100%;
            margin-top: 20px;
        }

        .financial-item {
            margin-bottom: 15px;
            text-align: center;
        }

        .financial-item h3 {
            font-size: 18px;
            font-weight: 300;
            color: #6B7D8D;
            margin-bottom: 5px;
        }

        .financial-item p {
            font-size: 20px;
            font-weight: 700; /* Inter Bold */
            color: #173248;
            margin: 0;
        }

        .financial-item p.red {
            color: #ED5C5C;
        }

        .financial-item p.green {
            color: #75BB7D;
        }

        .financial-item p.black {
            color: #000000; /* New class for black color */
        }

        /* Footer Styling */
        .calculator-footer {
            text-align: center;
            margin-top: 25px;
            font-size: 14px;
            color: #777777;
        }

        /* Liner Note Styling */
        .liner-note {
            text-align: center;
            margin-top: 15px;
            font-size: 12px;
            color: #6B7D8D;
            font-weight: 300;
        }

        .liner-note .footnote {
            margin-top: 10px; /* Adjust the value as needed */
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            .result-item {
                width: 100%;
            }

            .gauge {
                width: 156px;
                height: 156px;
            }

            .financial-item p {
                font-size: 18px;
            }

            /* Added responsive styles for financial-metrics-center */
            .financial-metrics-center {
                flex-direction: column; /* Stacks items vertically on small screens */
            }

            .financial-metrics-center h3.total-additional-profit,
            .financial-metrics-center p.black {
                margin-right: 0; /* Removes right margin when stacked */
            }
        }

        /* Modal Styling */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(243,243,243,0.96); /* Light background with opacity */
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; /* 5% from the top and centered */
            padding: 20px;
            border: 0px solid #888;
            width: 90%; /* Adjusted for better mobile view */
            max-width: 800px; /* Limit width on large screens */
            border-radius: 10px;
            position: relative;
            font-family: 'Inter', sans-serif;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            right: 20px;
            top: 10px;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

/* Watermark Styles */
.watermark {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) rotate(-45deg);
    font-size: 80px;
    color: rgba(200, 200, 200, 0.3); /* Light gray with 30% opacity */
    pointer-events: none; /* Allow clicks to pass through the watermark */
    user-select: none; /* Prevent text selection */
    white-space: nowrap; /* Prevent text wrapping */
    z-index: 1000; /* Ensure it sits above other content */
}

        /* Report Content Styling */
        .report-content {
            font-size: 16px;
            color: #333333;
        }

        .report-content h2 {
            text-align: left; /* Changed from center to left */
            color: #406795; /* Changed to supplied blue */
            margin-bottom: 20px;
            font-size: 30px; /* Increased font size */
        }

        .report-content h3.blue-header {
            color: #406795; /* Supplied blue color */
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 30px; /* Increased font size */
        }

        .report-content p {
            margin: 10px 0;
            line-height: 1.6;
        }

        .report-content .highlight {
            font-weight: 700;
            color: #173248;
        }

        .report-content .subtext {
            font-size: 14px;
            color: #6B7D8D;
        }

        /* Logo Styling in Report */
        .report-content .logo {
            text-align: left; /* Left justified */
            margin-bottom: 10px; /* Reduced margin to accommodate the line */
        }

        .report-content .logo img {
            max-width: 175px; /* 2x larger than previous 150px */
            height: auto;
        }

        /* Horizontal Line Below Logo */
        .report-content .horizontal-line {
            border: 0;
            height: 1px;
            background-color: #406795; /* Same blue as headers */
            margin: 10px 0 20px 0; /* Spacing around the line */
            width: 100%;
        }

        /* Additional Modal-Specific Styling */
        .report-content .results-section {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin: 10px 0; /* Shortened from 20px to 10px */
        }

        .report-content .result-item {
            width: 30%; /* Adjusted for 3 columns */
            margin-bottom: 20px;
            text-align: center;
        }

        .report-content .result-item.annualized-lost-labor {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .report-content .result-item.annualized-lost-labor h3,
        .report-content .result-item.annualized-lost-labor p.red {
            margin: 0;
        }

        .report-content .result-item.annualized-lost-labor p.red {
            font-size: 20px;
            font-weight: 700; /* Inter Bold */
            color: #ED5C5C;
        }

        /* Flexbox for financial-metrics-center to align header and number on the same line */
        .report-content .financial-metrics-center {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: nowrap;
            text-align: center; /* Ensures text is centered when on the same line */
            margin-top: 15px;
        }

        /* Add spacing between the header and the number */
        .report-content .financial-metrics-center h3.total-additional-profit {
            text-transform: uppercase; /* ALL CAPS */
            font-weight: 500;          /* Bold (Inter Semi Bold approximated with 700) */
            letter-spacing: -0.03em;   /* -0.02em letter-spacing */
            color: #000000;            /* Black */
            font-size: 24px;           /* Increased font size */
            margin-right: 10px;        /* Adds space between text and number */
        }

        /* Ensure the number has the same font size as the headers */
        .report-content .financial-metrics-center p.black {
            font-size: 30px; /* Increased to match header */
            font-weight: 500; /* Ensures boldness for emphasis */
            color: #000000; /* Black color as specified */
            margin: 0; /* Removes default margins */
        }

        /* Dynamic Paragraph Styling */
        .report-content .dynamic-paragraph {
            text-align: left;
            margin-top: 20px;
        }

        .report-content .dynamic-paragraph p {
            font-size: 16px;
            color: #333333;
        }

        /* Download PDF Button Styling */
        .report-content .download-pdf-button {
            display: block;
            margin: 20px auto 0;
            padding: 10px 20px;
            background-color: #6666c6;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            text-align: center;
            text-decoration: none;
        }

        .report-content .download-pdf-button:hover {
            background-color: #496691;
        }

        /* Adjust Gauge Size in Report */
        .report-content .gauge {
            width: 150px;
            height: 150px;
            margin: 0 auto 10px; /* Center gauges */
        }

        @media (max-width: 600px) {
            .report-content .result-item {
                width: 100%;
            }

            .report-content .gauge {
                width: 100%;
                max-width: 150px;
                margin: 0 auto 10px;
            }

            /* Stacks the header and number vertically on small screens */
            .financial-metrics-center {
                flex-direction: column; /* Stacks items vertically on small screens */
            }

            .financial-metrics-center h3.total-additional-profit,
            .financial-metrics-center p.black {
                margin-right: 0; /* Removes right margin when stacked */
            }
        }

    </style>
</head>
<body>

<div class="calculator-container">
    <div class="calculator-header">
        <h2>The Culture MRIÂ® Performance Estimator</h2>
        <p>Discover How Employee Engagement Impacts Your Profitability</p>
    </div>

    <div class="input-section">
        <!-- Total Labor Spend Input -->
        <div class="input-group">
            <label for="totalLaborCost">Total Labor Spend (USD)</label>
            <input type="text" id="totalLaborCost" placeholder="Enter your total labor spend">
        </div>

        <!-- Estimated Employee Engagement Input -->
        <div class="input-group">
            <label for="employeeEngagement">Estimated Employee Engagement (%)</label>
            <input type="number" id="employeeEngagement" placeholder="Enter estimated employee engagement" min="0" max="100">
        </div>

        <!-- Projected Turnover Percentage Input -->
        <div class="input-group">
            <label for="turnoverPercentage">Projected Turnover Percentage (%)</label>
            <input type="number" id="turnoverPercentage" placeholder="Enter projected turnover percentage" min="0" max="100">
        </div>
    </div>

    <div class="results-section">
        <!-- Overall Engagement Gauge -->
        <div class="result-item">
            <h3>Overall Engagement</h3>
            <div class="gauge">
                <svg width="195" height="195" viewBox="0 0 195 195">
                    <!-- Background Arc -->
                    <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                    <!-- Fill Arc -->
                    <path class="gauge__fill" id="engagementFill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                          stroke="#ED5C5C" stroke-dasharray="367.566" stroke-dashoffset="367.566" />
                    <!-- Percentage Text -->
                    <text x="97.5" y="115" text-anchor="middle" font-size="31px" font-weight="700"
                          fill="#173248" id="engagementText">0%</text>
                </svg>
            </div>
        </div>

        <!-- Return-On-LaborÂ® Gauge -->
        <div class="result-item">
            <h3>Return-On-LaborÂ®</h3>
            <div class="gauge">
                <svg width="195" height="195" viewBox="0 0 195 195">
                    <!-- Background Arc -->
                    <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                    <!-- Fill Arc -->
                    <path class="gauge__fill" id="returnOnLaborFill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                          stroke="#E1D687" stroke-dasharray="367.566" stroke-dashoffset="367.566" />
                    <!-- Percentage Text -->
                    <text x="97.5" y="115" text-anchor="middle" font-size="31px" font-weight="700"
                          fill="#173248" id="returnOnLaborText">0%</text>
                </svg>
            </div>
        </div>
    </div>

    <div class="financial-metrics">
        <!-- A 1% Engagement Shift in Engagement is worth -->
        <div class="financial-item">
            <h3>A 1% Shift in Engagement is worth</h3>
            <p class="green" id="onePercentChange">--</p>
        </div>

        <!-- Annualized Lost Labor -->
        <div class="financial-item">
            <h3>Annualized Lost Labor</h3>
            <p class="red" id="lostLaborCost">--</p>
        </div>

        <!-- Annualized Total Losses with Turnover -->
        <div class="financial-item">
            <h3>Annualized Total Losses with Turnover</h3>
            <p class="red" id="totalAnnualizedLosses">--</p>
        </div>

        <!-- Generate Report Button moved here -->
        <div class="financial-item generate-report-group">
            <button type="button" id="generateReportButton">Generate Projected Profitability Report</button>
        </div>
    </div>

    <div class="calculator-footer">
        <p>&copy; 2024 The Culture MRIÂ®. All Rights Reserved.</p>
    </div>

    <div class="liner-note">
        <em>*For simplicity, headcount is estimated using national average salary figures.</em>
    </div>
</div>

<!-- Report Modal -->
<div id="reportModal" class="modal">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <div class="report-content" id="reportContent">
            <!-- Report content will be injected here -->
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // **Element References**
        const inputLaborCost = document.getElementById('totalLaborCost');
        const inputEngagement = document.getElementById('employeeEngagement');
        const inputTurnover = document.getElementById('turnoverPercentage');

        const engagementFill = document.getElementById('engagementFill');
        const engagementText = document.getElementById('engagementText');

        const returnOnLaborFill = document.getElementById('returnOnLaborFill');
        const returnOnLaborText = document.getElementById('returnOnLaborText');

        const lostLaborCostEl = document.getElementById('lostLaborCost');
        const onePercentChangeEl = document.getElementById('onePercentChange');
        const totalAnnualizedLossesEl = document.getElementById('totalAnnualizedLosses');

        const generateReportButton = document.getElementById('generateReportButton');

        // **Modal Elements**
        const reportModal = document.getElementById('reportModal');
        const closeButton = document.querySelector('.close-button');
        const reportContent = document.getElementById('reportContent');

        // **Initialize Gauges and Displays**
        calculateMetrics();

        // **Add Event Listeners for Inputs**
        inputLaborCost.addEventListener('input', function(e) {
            // Remove non-digit characters except decimal point
            const value = e.target.value.replace(/,/g, '').replace(/[^0-9.]/g, '');
            // Format with commas
            e.target.value = formatNumberWithCommas(value);
            calculateMetrics();
        });

        inputEngagement.addEventListener('input', function() {
            calculateMetrics();
        });

        inputTurnover.addEventListener('input', function() {
            calculateMetrics();
        });

        // **Helper Function to Format Numbers with Commas**
        function formatNumberWithCommas(number) {
            if (!number) return '';
            const parts = number.toString().split(".");
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            return parts.join(".");
        }

        // **Function to Update Gauge Elements**
        function updateGauge(fillElement, percentage, color) {
            // Ensure percentage does not exceed 100%
            const cappedPercentage = Math.min(Math.max(percentage, 0), 100);
            const dashArray = 367.566; // For radius 78
            const dashOffset = dashArray - (cappedPercentage / 100) * dashArray;

            fillElement.style.strokeDasharray = dashArray;
            fillElement.style.strokeDashoffset = dashOffset;
            fillElement.style.stroke = color;
        }

        // **Function to Calculate Metrics Based on Inputs**
        function calculateMetrics() {
            // Parse the labor cost input by removing commas
            const laborCost = parseFloat(inputLaborCost.value.replace(/,/g, ''));
            const engagementPercentage = parseFloat(inputEngagement.value);
            const turnoverPercentage = parseFloat(inputTurnover.value);

            // Constants
            const averageSalary = 60000; // Assumed average salary
            const costToReplaceOneEmployee = 9861; // Given average replacement cost

            if (
                isNaN(laborCost) || laborCost <= 0 ||
                isNaN(engagementPercentage) || engagementPercentage < 0 || engagementPercentage > 100 ||
                isNaN(turnoverPercentage) || turnoverPercentage < 0 || turnoverPercentage > 100
            ) {
                resetGauges();
                return;
            }

            /*** Update Overall Engagement Gauge ***/
            let engagementColor = '';

            if (engagementPercentage <= 45) {
                engagementColor = '#ED5C5C'; // Red
            } else if (engagementPercentage <= 70) {
                engagementColor = '#E1D687'; // Yellow
            } else {
                engagementColor = '#75BB7D'; // Green
            }

            updateGauge(engagementFill, engagementPercentage, engagementColor);
            engagementText.textContent = Math.round(engagementPercentage) + '%'; // Rounded

            /*** Calculate Return-On-LaborÂ® ***/
            const engagementFactor = (0.46 * (engagementPercentage / 100)) + 0.54;
            const returnOnLabor = engagementFactor * laborCost;
            const returnOnLaborPercentage = Math.round( (returnOnLabor / laborCost) * 100 ); // Rounded

            let returnOnLaborColor = '';

            if (returnOnLaborPercentage <= 45) {
                returnOnLaborColor = '#ED5C5C'; // Red
            } else if (returnOnLaborPercentage <= 70) {
                returnOnLaborColor = '#E1D687'; // Yellow
            } else {
                returnOnLaborColor = '#75BB7D'; // Green
            }

            updateGauge(returnOnLaborFill, returnOnLaborPercentage, returnOnLaborColor);
            returnOnLaborText.textContent = Math.round(returnOnLaborPercentage) + '%'; // Rounded

            /*** Update Financial Metrics ***/
            const lostLaborCost = laborCost - returnOnLabor;
            const formattedLostLaborCost = `-$${Math.round(lostLaborCost).toLocaleString('en-US')}`; // Rounded
            lostLaborCostEl.textContent = formattedLostLaborCost;

            const onePercentChange = Math.round(0.0046 * laborCost); // Rounded
            const formattedOnePercentChange = `$${onePercentChange.toLocaleString('en-US')}`;
            onePercentChangeEl.textContent = formattedOnePercentChange;

            /*** Calculate Projected Turnover Costs ***/
            // Estimate headcount
            const estimatedHeadcount = laborCost / averageSalary;

            // Convert turnover percentage to decimal
            const turnoverDecimal = turnoverPercentage / 100;

            // Projected Turnover Costs
            const projectedTurnoverCosts = estimatedHeadcount * turnoverDecimal * costToReplaceOneEmployee;

            /*** Calculate Total Annualized Losses ***/
            const totalAnnualizedLosses = lostLaborCost + projectedTurnoverCosts;
            const formattedTotalAnnualizedLosses = `-$${Math.round(totalAnnualizedLosses).toLocaleString('en-US')}`; // Rounded
            totalAnnualizedLossesEl.textContent = formattedTotalAnnualizedLosses;
        }

        // **Function to Reset Gauges and Financial Metrics**
        function resetGauges() {
            // Reset Overall Engagement gauge to 0%
            updateGauge(engagementFill, 0, '#ED5C5C');
            engagementText.textContent = '0%';

            // Reset Return-On-LaborÂ® gauge to 0%
            updateGauge(returnOnLaborFill, 0, '#E1D687');
            returnOnLaborText.textContent = '0%';

            // Reset financial metrics to '--'
            lostLaborCostEl.textContent = '--';
            onePercentChangeEl.textContent = '--';
            totalAnnualizedLossesEl.textContent = '--';
        }

        // **Generate Report Button Click Event**
        generateReportButton.addEventListener('click', function() {
            // Get current inputs
            const laborCost = parseFloat(inputLaborCost.value.replace(/,/g, ''));
            const engagementPercentage = parseFloat(inputEngagement.value);
            const turnoverPercentage = parseFloat(inputTurnover.value);

            // Validate inputs
            if (
                isNaN(laborCost) || laborCost <= 0 ||
                isNaN(engagementPercentage) || engagementPercentage < 0 || engagementPercentage > 100 ||
                isNaN(turnoverPercentage) || turnoverPercentage < 0 || turnoverPercentage > 100
            ) {
                alert("Please enter valid input values.");
                return;
            }

            // Calculate current metrics
            const currentEngagementFactor = (0.46 * (engagementPercentage / 100)) + 0.54;
            const currentReturnOnLabor = currentEngagementFactor * laborCost;
            const currentAnnualizedLostLabor = Math.round(laborCost - currentReturnOnLabor); // Rounded

            // Calculate projected metrics with 10% higher engagement
            const projectedEngagement = Math.min(engagementPercentage + 10, 100); // Cap at 100%
            const projectedEngagementFactor = (0.46 * (projectedEngagement / 100)) + 0.54;
            const projectedReturnOnLabor = projectedEngagementFactor * laborCost;
            const projectedAnnualizedLostLabor = Math.round(laborCost - projectedReturnOnLabor); // Rounded

            const additionalProfit = Math.round(currentAnnualizedLostLabor - projectedAnnualizedLostLabor); // Rounded

            // Calculate investment and net gain
            const investment = Math.round(additionalProfit / 3); // 1/3 of total additional profit
            const netGain = additionalProfit; // As per user's example

            // Format numbers with commas and no decimal places
            function formatCurrency(num) {
                return num.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 });
            }

            // Calculate stroke-dashoffset for gauges
            const currentEngagementDashOffset = 367.566 - (Math.round(engagementPercentage) / 100) * 367.566;
            const currentReturnOnLaborDashOffset = 367.566 - (Math.round( (currentReturnOnLabor / laborCost) * 100 )) * 367.566 / 100;

            const projectedEngagementDashOffset = 367.566 - (Math.round(projectedEngagement) / 100) * 367.566;
            const projectedReturnOnLaborDashOffset = 367.566 - (Math.round( (projectedReturnOnLabor / laborCost) * 100 )) * 367.566 / 100;

            // Determine colors based on specified ranges
            function getColor(percentage) {
                if (percentage <= 45) {
                    return '#ED5C5C'; // Red
                } else if (percentage <= 70) {
                    return '#E1D687'; // Yellow
                } else {
                    return '#75BB7D'; // Green
                }
            }

            // Generate report content based on supplied text
            const reportHTML = `
                <div class="logo">
                    <img src="https://static.showit.co/file/UwdjWfwfRQ-XzVtd8ECO4g/176740/cmri_blue_for_dk.png" alt="The Culture MRIÂ® Logo">
                </div>
                <hr class="horizontal-line">
                <h2>Projected Financial Impact For Your Company</h2>
                <p>These recommendations are designed to provide a lift within the culture of your company by addressing the reported appetite for stronger vision. While these action steps are only described briefly here, we look forward to discussing each detail with your team and providing additional guidance as needed.</p>
                <p>Based on the rather conservative plan described in this report, your company can improve its Employee Value Proposition, better providing workers what they need to thrive and perform. This improvement requires no additional spending on salaries but maximizes the return on your current labor costs. The result will be higher productivity and profitability. Best of all, the impact will be measurable, not only in assessment scores, but also in financial results.</p>
                
                <!-- Before Section Header -->
                <h3 class="blue-header">Before:</h3>
                
                <p>Currently, youâre investing ${formatCurrency(laborCost)} annually in labor, but with a ${Math.round(engagementPercentage)}% engagement level, youâre losing ${formatCurrency(currentAnnualizedLostLabor)} in productivity each year. This is a significant hidden cost impacting your bottom line.</p>
                
                <!-- Insert Current Engagement Gauge, Return-On-LaborÂ® Gauge, and Annualized Lost Labor in 3 Columns -->
                <div class="results-section">
                    <div class="result-item">
                        <h3>Overall Engagement</h3>
                        <div class="gauge">
                            <svg width="150" height="150" viewBox="0 0 195 195">
                                <!-- Background Arc -->
                                <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                                <!-- Fill Arc -->
                                <path class="gauge__fill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                                      stroke="${getColor(Math.round(engagementPercentage))}" stroke-dasharray="367.566" stroke-dashoffset="${currentEngagementDashOffset}" />
                                <!-- Percentage Text -->
                                <text x="97.5" y="115" text-anchor="middle" font-size="24px" font-weight="700"
                                      fill="#173248">${Math.round(engagementPercentage)}%</text>
                            </svg>
                        </div>
                    </div>
                    <div class="result-item">
                        <h3>Return-On-LaborÂ®</h3>
                        <div class="gauge">
                            <svg width="150" height="150" viewBox="0 0 195 195">
                                <!-- Background Arc -->
                                <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                                <!-- Fill Arc -->
                                <path class="gauge__fill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                                      stroke="${getColor(Math.round( (currentReturnOnLabor / laborCost) * 100 ))}" stroke-dasharray="367.566" stroke-dashoffset="${currentReturnOnLaborDashOffset}" />
                                <!-- Percentage Text -->
                                <text x="97.5" y="115" text-anchor="middle" font-size="24px" font-weight="700"
                                      fill="#173248">${Math.round( (currentReturnOnLabor / laborCost) * 100 )}%</text>
                            </svg>
                        </div>
                    </div>
                    <div class="result-item annualized-lost-labor">
                        <h3>Annualized Lost Labor</h3>
                        <p class="red">${formatCurrency(currentAnnualizedLostLabor)}</p>
                    </div>
                </div>
                
                <!-- After Section Header -->
                <h3 class="blue-header">After:</h3>
                
                <p>By implementing targeted strategies and The Culture MRIÂ® recommendations to elevate employee engagement to ${projectedEngagement}%, you will recover ${formatCurrency(additionalProfit)} annually from your existing labor investment.</p>
                
                <!-- Insert Projected Engagement Gauge, Return-On-LaborÂ® Gauge, and Annualized Lost Labor in 3 Columns -->
                <div class="results-section">
                    <div class="result-item">
                        <h3>Overall Engagement</h3>
                        <div class="gauge">
                            <svg width="150" height="150" viewBox="0 0 195 195">
                                <!-- Background Arc -->
                                <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                                <!-- Fill Arc -->
                                <path class="gauge__fill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                                      stroke="${getColor(Math.round(projectedEngagement))}" stroke-dasharray="367.566" stroke-dashoffset="${projectedEngagementDashOffset}" />
                                <!-- Percentage Text -->
                                <text x="97.5" y="115" text-anchor="middle" font-size="24px" font-weight="700"
                                      fill="#173248">${projectedEngagement}%</text>
                            </svg>
                        </div>
                    </div>
                    <div class="result-item">
                        <h3>Return-On-LaborÂ®</h3>
                        <div class="gauge">
                            <svg width="150" height="150" viewBox="0 0 195 195">
                                <!-- Background Arc -->
                                <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                                <!-- Fill Arc -->
                                <path class="gauge__fill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                                      stroke="${getColor(Math.round( (projectedReturnOnLabor / laborCost) * 100 ))}" stroke-dasharray="367.566" stroke-dashoffset="${projectedReturnOnLaborDashOffset}" />
                                <!-- Percentage Text -->
                                <text x="97.5" y="115" text-anchor="middle" font-size="24px" font-weight="700"
                                      fill="#173248">${Math.round( (projectedReturnOnLabor / laborCost) * 100 )}%</text>
                            </svg>
                        </div>
                    </div>
                    <div class="result-item annualized-lost-labor">
                        <h3>Annualized Lost Labor</h3>
                        <p class="red">${formatCurrency(projectedAnnualizedLostLabor)}</p>
                    </div>
                </div>
                
                <!-- Conclusion Section Header -->
                <h3 class="blue-header">Conclusion:</h3>
                
                <!-- Dynamic Paragraph Below Conclusion -->
                <div class="dynamic-paragraph">
                    <p>The investment in these engagement initiatives is vastly outweighed by the financial gains. For instance, allocating ${formatCurrency(investment)} to our recommendations will generate a net gain of ${formatCurrency(netGain)} in the first year alone.</p>
                </div>
                
                <!-- Total Additional Profit (Annual): -->
                <div class="financial-metrics-center">
                    <h3 class="total-additional-profit">TOTAL ADDITIONAL PROFIT (ANNUAL):</h3>
                    <p class="black">${formatCurrency(additionalProfit)}</p>
                </div>
                
                <!-- Download PDF Button -->
                <button class="download-pdf-button no-pdf" id="downloadPDFButton">Download Sample Profitability Report</button>
            `;

            // **Inject Report Content into the Modal**
            reportContent.innerHTML = reportHTML;

            // **Add Three Watermark Divs**
            const watermarkTexts = [
                {
                    top: '20%', // Adjust as needed
                    left: '50%',
                    text: `
                        <div class="watermark-line">SAMPLE PROFITABILITY REPORT</div>
                        <div class="watermark-line">â BASED ON PROJECTIONS ONLY</div>
                    `
                },
                {
                    top: '50%', // Adjust as needed
                    left: '50%',
                    text: `
                        <div class="watermark-line">SAMPLE PROFITABILITY REPORT</div>
                        <div class="watermark-line">â BASED ON PROJECTIONS ONLY</div>
                    `
                },
                {
                    top: '80%', // Adjust as needed
                    left: '50%',
                    text: `
                        <div class="watermark-line">SAMPLE PROFITABILITY REPORT</div>
                        <div class="watermark-line">â BASED ON PROJECTIONS ONLY</div>
                    `
                }
            ];

            watermarkTexts.forEach(wm => {
                const watermarkDiv = document.createElement('div');
                watermarkDiv.classList.add('watermark');
                watermarkDiv.innerHTML = wm.text;
                // Set individual positions
                watermarkDiv.style.top = wm.top;
                watermarkDiv.style.left = wm.left;
                reportContent.appendChild(watermarkDiv);
            });

            // **Inject CSS Styles for Watermark and Disclaimer**
            const watermarkStyle = document.createElement('style');
            watermarkStyle.innerHTML = `
                /* Ensure the reportContent container is positioned relatively */
                #reportContent {
                    position: relative;
                }

                /* Watermark Styles */
                .watermark {
                    position: absolute;
                    transform: translate(-50%, -50%) rotate(-45deg);
                    text-align: center;
                    color: rgba(200, 200, 200, 0.3); /* Light gray with 30% opacity */
                    pointer-events: none; /* Allow clicks to pass through the watermark */
                    user-select: none; /* Prevent text selection */
                    z-index: 1000; /* Ensure it sits above other content */
                    font-family: Arial, sans-serif; /* Consistent font */
                }

                .watermark-line {
                    font-size: 36px; /* Adjust font size as needed */
                    line-height: 1.2; /* Adjust spacing between lines */
                }

                /* Additional CSS for Disclaimer (if implemented) */
                .report-disclaimer {
                    margin-top: 20px;
                    font-size: 12px;
                    color: #555;
                    border-top: 1px solid #ccc;
                    padding-top: 10px;
                }

                /* Responsive Adjustments (Optional) */
                @media (max-width: 768px) {
                    .watermark-line {
                        font-size: 24px;
                    }
                }
            `;
            document.head.appendChild(watermarkStyle);

            // **Display the Modal**
            reportModal.style.display = 'block';

            // **Add Event Listener for Download PDF Button**
            const downloadPDFButton = document.getElementById('downloadPDFButton');
            if (downloadPDFButton) {
                downloadPDFButton.addEventListener('click', function() {
                    // Hide elements with class 'no-pdf'
                    document.querySelectorAll('.no-pdf').forEach(function(element) {
                        element.style.display = 'none';
                    });

                    // Use html2canvas to capture the reportContent
                    html2canvas(reportContent, { scale: 3 }).then(canvas => { // Increased scale for better quality
                        const imgData = canvas.toDataURL('image/png');

                        // **Define Margins and Page Dimensions**
                        const marginLeft = 18; // 0.25in *72pt/in = 18pt
                        const marginTop = 18;  // 0.25in
                        const marginRight = 18; // 0.25in
                        const marginBottom = 36; // 0.5in

                        const pageWidth = 612; // 8.5in *72pt/in =612pt
                        const pageHeight = 792; //11in *72pt/in =792pt

                        const contentWidth = pageWidth - marginLeft - marginRight; //576pt
                        const contentHeight = pageHeight - marginTop - marginBottom; //738pt

                        // **Instantiate jsPDF with 'letter' format**
                        const pdf = new window.jspdf.jsPDF({
                            orientation: 'portrait',
                            unit: 'pt',
                            format: 'letter' // Changed from 'a4' to 'letter' for 8.5x11 inches
                        });

                        // **Calculate Image Dimensions to Fit Within Margins**
                        const imgWidth = canvas.width;
                        const imgHeight = canvas.height;

                        // Calculate the scaling factor to fit the image within the content area
                        const scaleFactor = Math.min(contentWidth / imgWidth, contentHeight / imgHeight);

                        // Calculate the scaled width and height
                        const scaledWidth = imgWidth * scaleFactor;
                        const scaledHeight = imgHeight * scaleFactor;

                        // Calculate the position to center the image within the content area
                        const x = marginLeft + (contentWidth - scaledWidth) / 2;
                        const y = marginTop + (contentHeight - scaledHeight) / 2;

                        // **Add the Image to PDF with Calculated Dimensions and Position**
                        pdf.addImage(imgData, 'PNG', x, y, scaledWidth, scaledHeight);

                        /*** Add Triple Watermark to PDF ***/
                        // Set font properties for watermark
                        pdf.setFontSize(36);
                        pdf.setTextColor(200, 200, 200); // Light gray color

                        // Define watermark texts and their positions
                        const pdfWatermarks = [
                            { text: 'SAMPLE PROFITABILITY REPORT', xOffset: -20, yOffset: -20 },
                            { text: 'â BASED ON PROJECTIONS ONLY', xOffset: -20, yOffset: 20 },
                            { text: 'SAMPLE PROFITABILITY REPORT', xOffset: 20, yOffset: -20 },
                            { text: 'â BASED ON PROJECTIONS ONLY', xOffset: 20, yOffset: 20 },
                            { text: 'SAMPLE PROFITABILITY REPORT', xOffset: 60, yOffset: -20 },
                            { text: 'â BASED ON PROJECTIONS ONLY', xOffset: 60, yOffset: 20 }
                        ];

                        // Add each watermark instance
                        pdfWatermarks.forEach(wm => {
                            pdf.text(wm.text, pageWidth / 2 + wm.xOffset, pageHeight / 2 + wm.yOffset, {
                                align: 'center',
                                angle: -45 // Rotate text by -45 degrees
                            });
                        });

                        // **Save the PDF**
                        pdf.save('Projected_Financial_Impact_Report.pdf');

                        // Show elements again
                        document.querySelectorAll('.no-pdf').forEach(function(element) {
                            element.style.display = '';
                        });

                        // Hide the Download Button after download
                        downloadPDFButton.style.display = 'none';
                    }).catch(err => {
                        console.error('Failed to generate PDF:', err);
                        alert('An error occurred while generating the PDF. Please try again.');
                    });
                });
            }
        });

        // **Close Modal When 'x' is Clicked**
        closeButton.addEventListener('click', function() {
            reportModal.style.display = 'none';
        });

        // **Close Modal When Clicking Outside the Modal Content**
        window.addEventListener('click', function(event) {
            if (event.target == reportModal) {
                reportModal.style.display = 'none';
            }
        });
    });
</script>

</body>
</html>
