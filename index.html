<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Culture MRI® Performance Estimator</title>
    <!-- Import Inter Font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    <!-- Viewport Meta Tag -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- jsPDF and html2canvas Libraries for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Apply Inter Font */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            padding: 20px;
            margin: 0;
        }

        /* Container Styling */
        .calculator-container {
            max-width: 700px;
            width: 100%;
            margin: 0 auto;
            padding: 25px;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        /* Header Styling */
        .calculator-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .calculator-header h2 {
            font-size: 28px;
            font-weight: 700; /* Inter Bold */
            color: #333333;
            margin-bottom: 5px;
        }

        .calculator-header p {
            font-size: 16px;
            font-weight: 300; /* Inter Light */
            color: #6B7D8D;
            margin: 0;
        }

        /* Input Section */
        .input-section {
            margin-bottom: 25px;
        }

        .input-group {
            margin-bottom: 25px;
            padding: 0 20px; /* Keep padding for consistent styling */
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 300; /* Inter Light */
            color: #6B7D8D;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            font-weight: 400; /* Inter Regular */
            border: 1px solid #d3d3d3;
            border-radius: 6px;
            outline: none;
        }

        /* Generate Report Button */
        #generateReportButton {
            width: 100%;
            padding: 12px;
            background-color: #6666c6;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        #generateReportButton:hover {
            background-color: #496691;
        }

        /* Results Section */
        .results-section {
            margin-top: 25px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .result-item {
            width: 48%;
            margin-bottom: 25px;
            text-align: center;
        }

        .result-item h3 {
            font-size: 18px;
            font-weight: 300; /* Inter Light */
            color: #6B7D8D;
            margin-bottom: 10px;
        }

        /* Gauge Styling */
        .gauge {
            width: 195px;
            height: 195px;
            position: relative;
            margin: 0 auto 10px; /* Reduced margin-bottom if necessary */
        }

        .gauge__background {
            stroke: #EFEFEF;
            stroke-width: 10;
            fill: none;
        }

        .gauge__fill {
            stroke-linecap: round;
            stroke-width: 10;
            fill: none;
            transition: stroke-dashoffset 0.5s ease-out, stroke 0.5s ease;
        }

        /* Financial Metrics */
        .financial-metrics {
            width: 100%;
            margin-top: 20px;
        }

        .financial-item {
            margin-bottom: 15px;
            text-align: center;
        }

        .financial-item h3 {
            font-size: 18px;
            font-weight: 300;
            color: #6B7D8D;
            margin-bottom: 5px;
        }

        .financial-item p {
            font-size: 20px;
            font-weight: 700; /* Inter Bold */
            color: #173248;
            margin: 0;
        }

        .financial-item p.red {
            color: #ED5C5C;
        }

        .financial-item p.green {
            color: #75BB7D;
        }

        .financial-item p.black {
            color: #000000; /* New class for black color */
        }

        /* Footer Styling */
        .calculator-footer {
            text-align: center;
            margin-top: 25px;
            font-size: 14px;
            color: #777777;
        }

        /* Liner Note Styling */
        .liner-note {
            text-align: center;
            margin-top: 15px;
            font-size: 12px;
            color: #6B7D8D;
            font-weight: 300;
        }

        .liner-note .footnote {
            margin-top: 10px; /* Adjust the value as needed */
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            .result-item {
                width: 100%;
            }

            .gauge {
                width: 156px;
                height: 156px;
            }

            .financial-item p {
                font-size: 18px;
            }
        }

        /* Modal Styling */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.5); /* Black w/ opacity */
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; /* 5% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 90%; /* Adjusted for better mobile view */
            max-width: 800px; /* Limit width on large screens */
            border-radius: 10px;
            position: relative;
            font-family: 'Inter', sans-serif;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            right: 20px;
            top: 10px;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Report Content Styling */
        .report-content {
            font-size: 16px;
            color: #333333;
        }

        .report-content h2 {
            text-align: left; /* Changed from center to left */
            color: #406795; /* Changed to supplied blue */
            margin-bottom: 20px;
        }

        .report-content h3.blue-header {
            color: #406795; /* Supplied blue color */
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .report-content p {
            margin: 10px 0;
            line-height: 1.6;
        }

        .report-content .highlight {
            font-weight: 700;
            color: #173248;
        }

        .report-content .subtext {
            font-size: 14px;
            color: #6B7D8D;
        }

        /* Logo Styling in Report */
        .report-content .logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .report-content .logo img {
            max-width: 150px;
        }

        /* Additional Modal-Specific Styling */
        .report-content .results-section {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin: 10px 0; /* Shortened from 20px to 10px */
        }

        .report-content .result-item {
            width: 45%;
            margin-bottom: 20px;
            text-align: center;
        }

        .report-content .result-item h3 {
            margin-bottom: 5px;
        }

        /* Center "Annualized Lost Labor" Below Gauges */
        .report-content .financial-metrics-center {
            text-align: center;
            margin-top: 15px;
        }

        .report-content .financial-metrics-center h3 {
            font-size: 18px;
            font-weight: 300;
            color: #6B7D8D;
            margin-bottom: 5px;
        }

        .report-content .financial-metrics-center p.red {
            font-size: 20px;
            font-weight: 700;
            color: #ED5C5C;
            margin: 0;
        }

        .report-content .financial-metrics-center p.black {
            font-size: 20px;
            font-weight: 700;
            color: #000000; /* Black color for Conclusion */
            margin: 0;
        }

        /* Specific Styling for "Total Additional Profit (Annual):" */
        .report-content .financial-metrics-center h3.total-additional-profit {
            text-transform: uppercase; /* ALL CAPS */
            font-weight: 700;          /* Bold (Inter Semi Bold approximated with 700) */
            letter-spacing: -0.02em;   /* -0.07em letter-spacing */
            color: #000000;            /* Black */
        }

        /* Dynamic Paragraph Styling */
        .report-content .dynamic-paragraph {
            text-align: left;
            margin-top: 20px;
        }

        .report-content .dynamic-paragraph p {
            font-size: 16px;
            color: #333333;
        }

        /* Download PDF Button Styling */
        .report-content .download-pdf-button {
            display: block;
            margin: 20px auto 0;
            padding: 10px 20px;
            background-color: #6666c6;
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            text-align: center;
            text-decoration: none;
        }

        .report-content .download-pdf-button:hover {
            background-color: #496691;
        }

        /* Adjust Gauge Size in Report */
        .report-content .gauge {
            width: 150px;
            height: 150px;
            margin: 0 auto 10px; /* Center gauges */
        }

        @media (max-width: 600px) {
            .report-content .result-item {
                width: 100%;
            }

            .report-content .gauge {
                width: 100%;
                max-width: 150px;
                margin: 0 auto 10px;
            }
        }

    </style>
</head>
<body>

<div class="calculator-container">
    <div class="calculator-header">
        <h2>The Culture MRI® Performance Estimator</h2>
        <p>Discover How Employee Engagement Impacts Your Profitability</p>
    </div>

    <div class="input-section">
        <!-- Total Labor Spend Input -->
        <div class="input-group">
            <label for="totalLaborCost">Total Labor Spend (USD)</label>
            <input type="text" id="totalLaborCost" placeholder="Enter your total labor spend">
        </div>

        <!-- Estimated Employee Engagement Input -->
        <div class="input-group">
            <label for="employeeEngagement">Estimated Employee Engagement (%)</label>
            <input type="number" id="employeeEngagement" placeholder="Enter estimated employee engagement" min="0" max="100">
        </div>

        <!-- Projected Turnover Percentage Input -->
        <div class="input-group">
            <label for="turnoverPercentage">Projected Turnover Percentage (%)</label>
            <input type="number" id="turnoverPercentage" placeholder="Enter projected turnover percentage" min="0" max="100">
        </div>
    </div>

    <div class="results-section">
        <!-- Overall Engagement Gauge -->
        <div class="result-item">
            <h3>Overall Engagement</h3>
            <div class="gauge">
                <svg width="195" height="195" viewBox="0 0 195 195">
                    <!-- Background Arc -->
                    <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                    <!-- Fill Arc -->
                    <path class="gauge__fill" id="engagementFill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                          stroke="#ED5C5C" stroke-dasharray="367.566" stroke-dashoffset="367.566" />
                    <!-- Percentage Text -->
                    <text x="97.5" y="115" text-anchor="middle" font-size="31px" font-weight="700"
                          fill="#173248" id="engagementText">0%</text>
                </svg>
            </div>
        </div>

        <!-- Return-On-Labor® Gauge -->
        <div class="result-item">
            <h3>Return-On-Labor®</h3>
            <div class="gauge">
                <svg width="195" height="195" viewBox="0 0 195 195">
                    <!-- Background Arc -->
                    <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                    <!-- Fill Arc -->
                    <path class="gauge__fill" id="returnOnLaborFill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                          stroke="#E1D687" stroke-dasharray="367.566" stroke-dashoffset="367.566" />
                    <!-- Percentage Text -->
                    <text x="97.5" y="115" text-anchor="middle" font-size="31px" font-weight="700"
                          fill="#173248" id="returnOnLaborText">0%</text>
                </svg>
            </div>
        </div>
    </div>

    <div class="financial-metrics">
        <!-- A 1% Engagement Shift in Engagement is worth -->
        <div class="financial-item">
            <h3>A 1% Shift in Engagement is worth</h3>
            <p class="green" id="onePercentChange">--</p>
        </div>

        <!-- Annualized Lost Labor -->
        <div class="financial-item">
            <h3>Annualized Lost Labor</h3>
            <p class="red" id="lostLaborCost">--</p>
        </div>

        <!-- Annualized Total Losses with Turnover -->
        <div class="financial-item">
            <h3>Annualized Total Losses with Turnover</h3>
            <p class="red" id="totalAnnualizedLosses">--</p>
        </div>

        <!-- Generate Report Button moved here -->
        <div class="financial-item generate-report-group">
            <button type="button" id="generateReportButton">Generate Projected Profitability Analysis Report</button>
        </div>
    </div>

    <div class="calculator-footer">
        <p>&copy; 2024 The Culture MRI®. All Rights Reserved.</p>
    </div>

    <div class="liner-note">
        <em>*For simplicity, headcount is estimated using national average salary figures.</em>
    </div>
</div>

<!-- Report Modal -->
<div id="reportModal" class="modal">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <div class="report-content" id="reportContent">
            <!-- Report content will be injected here -->
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const inputLaborCost = document.getElementById('totalLaborCost');
        const inputEngagement = document.getElementById('employeeEngagement');
        const inputTurnover = document.getElementById('turnoverPercentage');

        const engagementFill = document.getElementById('engagementFill');
        const engagementText = document.getElementById('engagementText');

        const returnOnLaborFill = document.getElementById('returnOnLaborFill');
        const returnOnLaborText = document.getElementById('returnOnLaborText');

        const lostLaborCostEl = document.getElementById('lostLaborCost');
        const onePercentChangeEl = document.getElementById('onePercentChange');
        const totalAnnualizedLossesEl = document.getElementById('totalAnnualizedLosses');

        const generateReportButton = document.getElementById('generateReportButton');

        // Modal elements
        const reportModal = document.getElementById('reportModal');
        const closeButton = document.querySelector('.close-button');
        const reportContent = document.getElementById('reportContent');

        // Initialize gauges and displays
        calculateMetrics();

        // Add event listeners
        inputLaborCost.addEventListener('input', function(e) {
            // Remove non-digit characters except decimal point
            const value = e.target.value.replace(/,/g, '').replace(/[^0-9.]/g, '');
            // Format with commas
            e.target.value = formatNumberWithCommas(value);
            calculateMetrics();
        });

        inputEngagement.addEventListener('input', function() {
            calculateMetrics();
        });

        inputTurnover.addEventListener('input', function() {
            calculateMetrics();
        });

        function formatNumberWithCommas(number) {
            if (!number) return '';
            const parts = number.toString().split(".");
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            return parts.join(".");
        }

        function updateGauge(fillElement, percentage, color) {
            // Ensure percentage does not exceed 100%
            const cappedPercentage = Math.min(Math.max(percentage, 0), 100);
            const dashArray = 367.566; // For radius 78
            const dashOffset = dashArray - (cappedPercentage / 100) * dashArray;

            fillElement.style.strokeDasharray = dashArray;
            fillElement.style.strokeDashoffset = dashOffset;
            fillElement.style.stroke = color;
        }

        function calculateMetrics() {
            // Parse the labor cost input by removing commas
            const laborCost = parseFloat(inputLaborCost.value.replace(/,/g, ''));
            const engagementPercentage = parseFloat(inputEngagement.value);
            const turnoverPercentage = parseFloat(inputTurnover.value);

            // Constants
            const averageSalary = 60000; // Assumed average salary
            const costToReplaceOneEmployee = 9861; // Given average replacement cost

            if (
                isNaN(laborCost) || laborCost <= 0 ||
                isNaN(engagementPercentage) || engagementPercentage < 0 || engagementPercentage > 100 ||
                isNaN(turnoverPercentage) || turnoverPercentage < 0 || turnoverPercentage > 100
            ) {
                resetGauges();
                return;
            }

            /*** Update Overall Engagement Gauge ***/
            let engagementColor = '';

            if (engagementPercentage <= 45) {
                engagementColor = '#ED5C5C'; // Red
            } else if (engagementPercentage <= 70) {
                engagementColor = '#E1D687'; // Yellow
            } else {
                engagementColor = '#75BB7D'; // Green
            }

            updateGauge(engagementFill, engagementPercentage, engagementColor);
            engagementText.textContent = Math.round(engagementPercentage) + '%'; // Rounded

            /*** Calculate Return-On-Labor® ***/
            const engagementFactor = (0.46 * (engagementPercentage / 100)) + 0.54;
            const returnOnLabor = engagementFactor * laborCost;
            const returnOnLaborPercentage = Math.round( (returnOnLabor / laborCost) * 100 ); // Rounded

            let returnOnLaborColor = '';

            if (returnOnLaborPercentage <= 45) {
                returnOnLaborColor = '#ED5C5C'; // Red
            } else if (returnOnLaborPercentage <= 70) {
                returnOnLaborColor = '#E1D687'; // Yellow
            } else {
                returnOnLaborColor = '#75BB7D'; // Green
            }

            updateGauge(returnOnLaborFill, returnOnLaborPercentage, returnOnLaborColor);
            returnOnLaborText.textContent = Math.round(returnOnLaborPercentage) + '%'; // Rounded

            /*** Update Financial Metrics ***/
            const lostLaborCost = laborCost - returnOnLabor;
            const formattedLostLaborCost = `-$${Math.round(lostLaborCost).toLocaleString('en-US')}`; // Rounded
            lostLaborCostEl.textContent = formattedLostLaborCost;

            const onePercentChange = Math.round(0.0046 * laborCost); // Rounded
            const formattedOnePercentChange = `$${onePercentChange.toLocaleString('en-US')}`;
            onePercentChangeEl.textContent = formattedOnePercentChange;

            /*** Calculate Projected Turnover Costs ***/
            // Estimate headcount
            const estimatedHeadcount = laborCost / averageSalary;

            // Convert turnover percentage to decimal
            const turnoverDecimal = turnoverPercentage / 100;

            // Projected Turnover Costs
            const projectedTurnoverCosts = estimatedHeadcount * turnoverDecimal * costToReplaceOneEmployee;

            /*** Calculate Total Annualized Losses ***/
            const totalAnnualizedLosses = lostLaborCost + projectedTurnoverCosts;
            const formattedTotalAnnualizedLosses = `-$${Math.round(totalAnnualizedLosses).toLocaleString('en-US')}`; // Rounded
            totalAnnualizedLossesEl.textContent = formattedTotalAnnualizedLosses;
        }

        function resetGauges() {
            // Reset Overall Engagement gauge to 0%
            updateGauge(engagementFill, 0, '#ED5C5C');
            engagementText.textContent = '0%';

            // Reset Return-On-Labor® gauge to 0%
            updateGauge(returnOnLaborFill, 0, '#E1D687');
            returnOnLaborText.textContent = '0%';

            // Reset financial metrics to '--'
            lostLaborCostEl.textContent = '--';
            onePercentChangeEl.textContent = '--';
            totalAnnualizedLossesEl.textContent = '--';
        }

        // Generate Report Button Click Event
        generateReportButton.addEventListener('click', function() {
            // Get current inputs
            const laborCost = parseFloat(inputLaborCost.value.replace(/,/g, ''));
            const engagementPercentage = parseFloat(inputEngagement.value);
            const turnoverPercentage = parseFloat(inputTurnover.value);

            // Validate inputs
            if (
                isNaN(laborCost) || laborCost <= 0 ||
                isNaN(engagementPercentage) || engagementPercentage < 0 || engagementPercentage > 100 ||
                isNaN(turnoverPercentage) || turnoverPercentage < 0 || turnoverPercentage > 100
            ) {
                alert("Please enter valid input values.");
                return;
            }

            // Calculate current metrics
            const currentEngagementFactor = (0.46 * (engagementPercentage / 100)) + 0.54;
            const currentReturnOnLabor = currentEngagementFactor * laborCost;
            const currentAnnualizedLostLabor = Math.round(laborCost - currentReturnOnLabor); // Rounded

            // Calculate projected metrics with 10% higher engagement
            const projectedEngagement = Math.min(engagementPercentage + 10, 100); // Cap at 100%
            const projectedEngagementFactor = (0.46 * (projectedEngagement / 100)) + 0.54;
            const projectedReturnOnLabor = projectedEngagementFactor * laborCost;
            const projectedAnnualizedLostLabor = Math.round(laborCost - projectedReturnOnLabor); // Rounded

            const additionalProfit = Math.round(currentAnnualizedLostLabor - projectedAnnualizedLostLabor); // Rounded

            // Calculate investment and net gain
            const investment = Math.round(additionalProfit / 3); // 1/3 of total additional profit
            const netGain = additionalProfit; // As per user's example

            // Format numbers with commas and no decimal places
            function formatCurrency(num) {
                return num.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 });
            }

            // Calculate stroke-dashoffset for gauges
            const currentEngagementDashOffset = 367.566 - (Math.round(engagementPercentage) / 100) * 367.566;
            const currentReturnOnLaborDashOffset = 367.566 - (Math.round( (currentReturnOnLabor / laborCost) * 100 )) * 367.566 / 100;

            const projectedEngagementDashOffset = 367.566 - (Math.round(projectedEngagement) / 100) * 367.566;
            const projectedReturnOnLaborDashOffset = 367.566 - (Math.round( (projectedReturnOnLabor / laborCost) * 100 )) * 367.566 / 100;

            // Determine colors based on specified ranges
            function getColor(percentage) {
                if (percentage <= 45) {
                    return '#ED5C5C'; // Red
                } else if (percentage <= 70) {
                    return '#E1D687'; // Yellow
                } else {
                    return '#75BB7D'; // Green
                }
            }

            // Generate report content based on supplied text
            const reportHTML = `
                <div class="logo">
                    <img src="https://static.showit.co/file/UwdjWfwfRQ-XzVtd8ECO4g/176740/cmri_blue_for_dk.png" alt="The Culture MRI® Logo">
                </div>
                <h2>Projected Financial Impact For Your Company</h2>
                <p>These recommendations are designed to provide a lift within the culture of your company by addressing the reported appetite for stronger vision. While these action steps are only described briefly here, we look forward to discussing each detail with your team and providing additional guidance as needed.</p>
                <p>Based on the rather conservative plan described in this report, your company can improve its Employee Value Proposition, better providing workers what they need to thrive and perform. This improvement requires no additional spending on salaries but maximizes the return on your current labor costs. The result will be higher productivity and profitability. Best of all, the impact will be measurable, not only in assessment scores, but also in financial results.</p>
                
                <!-- Before Section Header -->
                <h3 class="blue-header">Before:</h3>
                
                <p>Currently, you’re investing ${formatCurrency(laborCost)} annually in labor, but with a ${Math.round(engagementPercentage)}% engagement level, you’re losing ${formatCurrency(currentAnnualizedLostLabor)} in productivity each year. This is a significant hidden cost impacting your bottom line.</p>
                
                <!-- Insert Current Engagement Gauge and Return-On-Labor® Gauge -->
                <div class="results-section">
                    <div class="result-item">
                        <h3>Overall Engagement</h3>
                        <div class="gauge">
                            <svg width="150" height="150" viewBox="0 0 195 195">
                                <!-- Background Arc -->
                                <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                                <!-- Fill Arc -->
                                <path class="gauge__fill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                                      stroke="${getColor(Math.round(engagementPercentage))}" stroke-dasharray="367.566" stroke-dashoffset="${currentEngagementDashOffset}"
                                      stroke="${getColor(Math.round(engagementPercentage))}" />
                                <!-- Percentage Text -->
                                <text x="97.5" y="115" text-anchor="middle" font-size="24px" font-weight="700"
                                      fill="#173248">${Math.round(engagementPercentage)}%</text>
                            </svg>
                        </div>
                    </div>
                    <div class="result-item">
                        <h3>Return-On-Labor®</h3>
                        <div class="gauge">
                            <svg width="150" height="150" viewBox="0 0 195 195">
                                <!-- Background Arc -->
                                <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                                <!-- Fill Arc -->
                                <path class="gauge__fill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                                      stroke="${getColor(Math.round( (currentReturnOnLabor / laborCost) * 100 ))}" stroke-dasharray="367.566" stroke-dashoffset="${currentReturnOnLaborDashOffset}"
                                      stroke="${getColor(Math.round( (currentReturnOnLabor / laborCost) * 100 ))}" />
                                <!-- Percentage Text -->
                                <text x="97.5" y="115" text-anchor="middle" font-size="24px" font-weight="700"
                                      fill="#173248">${Math.round( (currentReturnOnLabor / laborCost) * 100 )}%</text>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <!-- Annualized Lost Labor Centered Below Gauges -->
                <div class="financial-metrics-center">
                    <h3>Annualized Lost Labor</h3>
                    <p class="red">${formatCurrency(currentAnnualizedLostLabor)}</p>
                </div>
                
                <!-- After Section Header -->
                <h3 class="blue-header">After:</h3>
                
                <p>By implementing targeted strategies and The Culture MRI® recommendations to elevate employee engagement to ${projectedEngagement}%, you will recover ${formatCurrency(additionalProfit)} annually from your existing labor investment.</p>
                
                <!-- Insert Projected Engagement Gauge and Return-On-Labor® Gauge -->
                <div class="results-section">
                    <div class="result-item">
                        <h3>Overall Engagement</h3>
                        <div class="gauge">
                            <svg width="150" height="150" viewBox="0 0 195 195">
                                <!-- Background Arc -->
                                <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                                <!-- Fill Arc -->
                                <path class="gauge__fill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                                      stroke="${getColor(Math.round(projectedEngagement))}" stroke-dasharray="367.566" stroke-dashoffset="${projectedEngagementDashOffset}"
                                      stroke="${getColor(Math.round(projectedEngagement))}" />
                                <!-- Percentage Text -->
                                <text x="97.5" y="115" text-anchor="middle" font-size="24px" font-weight="700"
                                      fill="#173248">${projectedEngagement}%</text>
                            </svg>
                        </div>
                    </div>
                    <div class="result-item">
                        <h3>Return-On-Labor®</h3>
                        <div class="gauge">
                            <svg width="150" height="150" viewBox="0 0 195 195">
                                <!-- Background Arc -->
                                <path class="gauge__background" d="M39 162.5 A78 78 0 1 1 156 162.5" />
                                <!-- Fill Arc -->
                                <path class="gauge__fill" d="M39 162.5 A78 78 0 1 1 156 162.5"
                                      stroke="${getColor(Math.round( (projectedReturnOnLabor / laborCost) * 100 ))}" stroke-dasharray="367.566" stroke-dashoffset="${projectedReturnOnLaborDashOffset}"
                                      stroke="${getColor(Math.round( (projectedReturnOnLabor / laborCost) * 100 ))}" />
                                <!-- Percentage Text -->
                                <text x="97.5" y="115" text-anchor="middle" font-size="24px" font-weight="700"
                                      fill="#173248">${Math.round( (projectedReturnOnLabor / laborCost) * 100 )}%</text>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <!-- Adjusted Annualized Lost Labor Centered Below Gauges -->
                <div class="financial-metrics-center">
                    <h3>Annualized Lost Labor</h3>
                    <p class="red">${formatCurrency(projectedAnnualizedLostLabor)}</p>
                </div>
                
                <!-- Conclusion Section Header -->
                <h3 class="blue-header">Conclusion:</h3>
                
                <!-- Dynamic Paragraph Below Conclusion -->
                <div class="dynamic-paragraph">
                    <p>The investment in these engagement initiatives is vastly outweighed by the financial gains. For instance, allocating ${formatCurrency(investment)} to our recommendations will generate a net gain of ${formatCurrency(netGain)} in the first year alone.</p>
                </div>
                
                <!-- Total Additional Profit (Annual): -->
                <div class="financial-metrics-center">
                    <h3 class="total-additional-profit">Total Additional Profit (Annual):</h3>
                    <p class="black">${formatCurrency(additionalProfit)}</p>
                </div>
                
                <!-- Download PDF Button -->
                <button class="download-pdf-button" id="downloadPDFButton">Download Report as PDF</button>
            `;

            // Inject report content into the modal
            reportContent.innerHTML = reportHTML;

            // Display the modal
            reportModal.style.display = 'block';

            // Add event listener for Download PDF button
            const downloadPDFButton = document.getElementById('downloadPDFButton');
            if (downloadPDFButton) {
                downloadPDFButton.addEventListener('click', function() {
                    // Use html2canvas to capture the reportContent
                    html2canvas(reportContent, { scale: 2 }).then(canvas => {
                        const imgData = canvas.toDataURL('image/png');
                        const { jsPDF } = window.jspdf;
                        const doc = new jsPDF({
                            orientation: 'portrait',
                            unit: 'px',
                            format: [canvas.width, canvas.height]
                        });
                        doc.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
                        doc.save('Projected_Financial_Impact_Report.pdf');
                    }).catch(err => {
                        console.error('Failed to generate PDF:', err);
                        alert('An error occurred while generating the PDF. Please try again.');
                    });
                });
            }
        });

        // Close Modal When 'x' is Clicked
        closeButton.addEventListener('click', function() {
            reportModal.style.display = 'none';
        });

        // Close Modal When Clicking Outside the Modal Content
        window.addEventListener('click', function(event) {
            if (event.target == reportModal) {
                reportModal.style.display = 'none';
            }
        });
    });
</script>

</body>
</html>
